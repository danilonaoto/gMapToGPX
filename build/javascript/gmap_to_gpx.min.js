/*! gmap-to-gpx 2013-10-05 */
function fixup(a){return a=a.replace(/\\x3e/g,">"),a=a.replace(/\\x3c/g,"<"),a=a.replace(/\\x26/g,"&"),a=a.replace(/\\x42/g,'"'),a=a.replace(/\\x3d/g,"="),a=a.replace(/\\u003e/g,">"),a=a.replace(/\\u003c/g,"<"),a=a.replace(/\\u0026/g,"&"),a=a.replace(/\\042/g,'"'),a=a.replace(/"*polylines"*:\s*/g,"polylines:"),a=a.replace(/"*markers"*:\s*/g,"markers:"),a=a.replace(/"*id"*:\s*/g,"id:"),a=a.replace(/"*lat"*:\s*/g,"lat:"),a=a.replace(/"*lng"*:\s*/g,"lng:"),a=a.replace(/"*laddr"*:\s*/g,"laddr:"),a=a.replace(/"*points"*:\s*/g,"points:"),a=a.replace(/\\"/g,'"'),a=a.replace(/\"/g,"'")}function callInProgress(a){switch(a.readyState){case 1:case 2:case 3:return!0;default:return!1}}function loadXMLDoc(a){var b,c;return window.XMLHttpRequest?(b=new XMLHttpRequest,showstatusdiv("Loading..."),c=window.setTimeout(function(){callInProgress(b)&&b.abort()},3e4),b.open("GET",a,!1),b.send(null),window.clearTimeout(c),hidestatusdiv()):window.ActiveXObject&&(b=new ActiveXObject("Microsoft.XMLHTTP"),b&&(showstatusdiv("Loading..."),c=window.setTimeout(function(){callInProgress(b)&&b.abort()},3e4),b.open("GET",a,!1),b.send(),window.clearTimeout(c),hidestatusdiv())),4==b.readyState?200==b.status?b.responseText:(showstatusdiv("Error "+b.status+" getting google data: "+b.statusText),""):(showstatusdiv("Error: loadXMLDoc continued with readystate: "+b.readyState),"")}function hidestatusdiv(){var a;(a=document.getElementById("statusbox"))&&document.body.removeChild(a)}function showstatusdiv(a){hidestatusdiv(),z=document.body.appendChild(document.createElement("div")),z.id="statusbox",z.style.position="absolute",null!=self.pageYOffset?z.style.top=self.pageYOffset+"px":null!=document.documentElement.scrollTop&&(z.style.top=document.documentElement.scrollTop+"px"),z.style.width="50%",z.style.left="0px",z.style.background="#ffffff",z.style.border=".3em solid #ff0000",z.style.padding=".3em 1.3em .3em .3em",z.style.zIndex="1000",z.innerHTML='<div style="position: absolute; border: 1px solid black; top: 0px; right: 0px;"><span style="padding: .3em; font-weight: bold;"><a style="text-decoration: none;" title="Close status box" href="#" onclick="javascript:hidestatusdiv();">X</a></span></div>',z.innerHTML+=a}function decodeLine(a){for(var b=a.length,c=0,d=[],e=0,f=0;b>c;){var g,h=0,i=0;do g=a.charCodeAt(c++)-63,i|=(31&g)<<h,h+=5;while(g>=32);var j=1&i?~(i>>1):i>>1;e+=j,h=0,i=0;do g=a.charCodeAt(c++)-63,i|=(31&g)<<h,h+=5;while(g>=32);var k=1&i?~(i>>1):i>>1;f+=k,d.push({lat:round(1e-5*e),lon:round(1e-5*f)})}return d}function StringBuffer(){this.buffer=[]}function gmaptogpxdiv(a){var b=0,c=0;if(gpxvar&&gpxvar.overlays&&gpxvar.overlays.polylines){for(b=2,m=0;m<gpxvar.overlays.polylines.length;m++)polylines[m]=decodeLine(gpxvar.overlays.polylines[m].points);if(segmatch=googledoc.match(/<span[^>]*class=.?dirsegtext.?.*?>.*?<\/span>/g))for(var d=0;d<segmatch.length;d++){var e=segmatch[d].replace(/.*dirsegtext_([0-9]+)_([0-9]+).*/,"$1"),f=segmatch[d].replace(/.*dirsegtext_([0-9]+)_([0-9]+).*/,"$2"),g=deamp(segmatch[d].replace(/.*?>(.*?)<\/span>.*/,"$1")),h=gpxvar.drive.trips[0].routes[e].steps[f].polyline,i=gpxvar.drive.trips[0].routes[e].steps[f].ppt;polylines[h][i].desc=deamp(g)}for(m=0;m<gpxvar.drive.trips[0].routes.length;m++){var j=gpxvar.drive.trips[0].routes[m].steps[0].polyline,k=gpxvar.drive.trips[0].routes[m].steps[gpxvar.drive.trips[0].routes[m].steps.length-1].polyline,e="route"+m;for(routes[e]=new Array,n=j;k>=n;n++)routes[e]=routes[e].concat(polylines[n])}var l;if(l=gpxvar.panel.match(/<div[^>]*id=.?sxaddr.*?>.*?<\/div>/g))for(var m=0;m<l.length;m++)milestones[parseInt(m)]=deamp(l[m].replace(/<div[^>]*id=.?sxaddr.?.*?><div[^>]+>(.*?)<\/div>/,"$1"))}else if(googledoc.match(/id:'(A|addr)'/)){b=1,routes.poi=new Array;for(var m=0;m<gpxvar.overlays.markers.length;m++){var g=gpxvar.overlays.markers[m].laddr;g=g.replace(/(.*) \((.*)\)/,"$2 ($1)"),routes.poi.push({lat:round(gpxvar.overlays.markers[m].latlng.lat),lon:round(gpxvar.overlays.markers[m].latlng.lng),desc:deamp(g)})}}if(document.location.hostname.indexOf("gmap-pedometer")>=0&&0==b&&self.o&&self.o[0]&&(b=3),0==b&&self.gLatLngArray&&self.gLatLngArray[0]&&(b=3,c=1),0==b&&location.href.match(/heywhatsthat.com/i)&&peaks&&peaks.length&&(b=4,c=1),0==b&&location.href.match(/yelp.com/i)&&document.body.innerHTML.match("result_plot_obj.map.addOverlay")){b=4,c=2;for(var p=document.body.innerHTML.match(/result_plot_obj.map.addOverlay.*?\)\)/g),m=0;m<p.length;m++)yelp[m]=new Array,yelp[m].name=deamp(p[m].replace(/.*<h3>(.*?)<\/h3>.*/,"$1")),yelp[m].addr=deamp(p[m].replace(/.*<address[^>]*>(.*?)<\/address>.*/,"$1")),yelp[m].lon=p[m].replace(/.*Yelp.TSRUrl.*?,.*?,.*?, (.*?),.*/,"$1"),yelp[m].lat=p[m].replace(/.*Yelp.TSRUrl.*?,.*?,.*?,.*?, (.*?),.*/,"$1")}if(0==b&&location.href.match(/yelp.com/i)&&json_biz&&(b=4,c=2,yelp[0]=new Array,yelp[0].name=json_biz.name,yelp[0].lat=json_biz.latitude,yelp[0].lon=json_biz.longitude,yelp[0].addr=json_biz.address1+", ",null!=json_biz.address2&&(yelp[0].addr+=json_biz.address2+", "),yelp[0].addr+=json_biz.city+", "+json_biz.state+" "+json_biz.zip),0==b&&location.href.match(/findmespot.com/i)&&document.getElementsByTagName("iframe")[1]&&document.getElementsByTagName("iframe")[1].contentDocument.getElementById("mapForm:inputHidden1").value&&(b=4,c=3),0==b&&location.href.match(/logyourrun.com/i)&&route_polyline&&(b=4,c=4),0==b)return errorbox("<p>There doesn't seem to be any extractable data on this page.</p><p>If there is, but it's not detected, please visit the <a href=\"http://www.elsewhere.org/GMapToGPX/\">project homepage</a> and leave a bug report, including a link to the page you're on right now.</p><p><strong>Note:</strong> Google Maps mashups (that is, a page with a Google Map on it, but not at google.com) do not automatically work with this utility. If you would like to see GMapToGPX work with a Google Maps mashup site you maintain, please leave a comment on the project page.</p>"),closebox(),0;var q="<div style='border:3px dotted orange;padding:2px;background-color:#FFFFFF;margin-left:auto;margin-right:auto;'>";if(navigator.userAgent.match(/Safari/)&&(q+='<style type="text/css">.menubar ul {	margin:0; }.menubar li {	display:inline;	list-style:none;	margin:0 5px 0 5px;}.menubar a , .menubar a:visited {	padding: 1px 10px 1px 10px;	text-decoration:none;        background-color: #3399CC;	color:white;	font-family:Verdana, Sans-Serif;	font-size:9pt;	-moz-border-radius:10px;	border:2px inset black;	font-weight: bolder;}.menubar select {    background-color: transparent;    color: #333333;    margin-top: 2px;    border: 1px solid #efefef;}.menubar a:hover , .menubar select:hover {	border:2px outset black;   	background-color:white;	color:blue;	text-decoration:none;}</style>'),q+="<div style='background-color:gray;'>",q+='<ul class="menubar">',q+='<li class="menubar">GMapToGPX v'+version+"</li>",b>1&&4!=b&&("route"!=a&&(q+='<li class="menubar"><a href="javascript:reload(0)" title="Turn points as a route">Route</a></li>'),"track"!=a&&(q+='<li class="menubar"><a href="javascript:reload(1)" title="Turn points as a track">Track</a></li>'),"points"!=a&&(q+='<li class="menubar"><a href="javascript:reload(2)" title="Turn points as waypoints">Points</a></li>'),2==b&&"allpoints"!=a&&(q+='<li class="menubar"><a href="javascript:reload(3)" title="ALL points as a track (potentially very large)">Full</a></li>')),q+='<li class="menubar"><a href="javascript:loadabout()">About</a></li>',q+='<li class="menubar"><a href="javascript:closebox()">CLOSE [X]</a></li></ul></div>',q+='<textarea rows="20" cols="60">',q+='<?xml version="1.0" encoding="'+charset+'" ?>\n'+'<gpx version="1.1"\n'+'     creator="GMapToGPX '+version+' - http://www.elsewhere.org/GMapToGPX/"\n'+'     xmlns="http://www.topografix.com/GPX/1/1"\n'+'     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n'+'     xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd">\n',2==b&&"allpoints"==a){q+="   <trk>\n",q+="      <name>Google Driving Directions Track</name>\n";var r=new StringBuffer;for(var s in routes){var e=routes[s];for(r.append("      <trkseg>\n"),m=0;m<e.length;m++){if(m==e.length-1)e[m].desc=milestones[1+parseInt(s.replace(/route/,""))];else if(e[m].lat==e[m+1].lat&&e[m].lon==e[m+1].lon)continue;r.append('      <trkpt lat="'),r.append(e[m].lat),r.append('" lon="'),r.append(e[m].lon),r.append('">'),e[m].desc&&(r.append("<cmt>"),r.append(deamp(e[m].desc)),r.append("</cmt>")),r.append("</trkpt>\n")}r.append("      </trkseg>\n")}r.append("   </trk>\n"),q+=r.toString()}else if(3==b){var t="";if(t=self.O&&self.O.length>0?"http://www.gmap-pedometer.com/?r="+self.O:"Permalink unavailable.",0==c)var u=A,v=o;else var u=[],v=self.gLatLngArray;var w=!0;if("undefined"!=typeof u&&v.length==u.length)for(var x=0;x<u.length;x++)"-1.79769313486231E+308"==u[x]&&(w=!1);else w=!1;"track"==a?(q+="   <trk>\n",q+="      <name>Gmaps Pedometer Track</name>\n      <cmt>Permalink: &lt;![CDATA[\n"+t+"\n]]>\n</cmt>\n",q+="      <trkseg>\n"):"route"==a&&(q+="   <rte>\n",q+="      <name>Gmaps Pedometer Route</name>\n      <cmt>Permalink: &lt;![CDATA[\n"+t+"\n]]>\n</cmt>\n");for(var m=0;m<v.length;m++){if("track"==a?q+="      <trkpt ":"route"==a?q+="      <rtept ":"points"==a&&(q+="      <wpt "),q+='lat="'+round(v[m].lat)+'" '+'lon="'+round(v[m].lng)+'">\n',1==w){var y=0;y=u[m],y=round(.3048*y),q+="         <ele>"+y+"</ele>\n"}q+="         <name>"+(m?"Turn "+m:"Start")+"</name>\n","track"==a?q+="      </trkpt>\n":"route"==a?q+="      </rtept>\n":"points"==a&&(q+="      </wpt>\n")}"track"==a?(q+="      </trkseg>\n",q+="   </trk>\n"):"route"==a&&(q+="   </rte>\n")}else if(4==b&&1==c)for(var m=0;m<peaks.length;m++){var z=peaks[m];q+='   <wpt lat="'+z.lat+'" lon="'+z.lon+'">\n'+"      <ele>"+z.elev+"</ele>\n"+"      <name>"+z.name+"</name>\n"+"      <cmt>"+z.name+"</cmt>\n"+"   </wpt>\n"}else if(4==b&&2==c)for(var m=0;m<yelp.length;m++){var z=yelp[m];q+='   <wpt lat="'+z.lat+'" lon="'+z.lon+'">\n'+"      <name>"+z.name+"</name>\n"+"      <cmt>"+z.addr+"</cmt>\n"+"   </wpt>\n"}else if(4==b&&3==c){var B=document.getElementsByTagName("iframe")[1].contentDocument.getElementById("mapForm:inputHidden1").value,C=B.split(","),D=C.length-1;q+="  <trk><trkseg>\n";for(var m=0;D>m;m++){var E=C[m].split("||"),F=E[0],G=E[1],H=E[2],I=E[3],J=E[4];q+='   <trkpt lat="'+G+'" lon="'+H+'">\n'+"      <name>"+m+"-"+I+"</name>\n"+"      <cmt>"+I+" "+F+" @ "+J+"</cmt>\n"+"      <desc>"+I+" "+F+" @ "+J+"</desc>\n"+"   </trkpt>\n"}q+="  </trkseg></trk>\n"}else if(4==b&&4==c){var K=decodeLine(route_polyline);q+="  <trk><trkseg>\n";for(var m=0;m<K.length;m++)q+='   <trkpt lat="'+K[m].lat+'" lon="'+K[m].lon+'">\n',q+="      <name>LYR"+m+"</name>\n"+"   </trkpt>\n";q+="  </trkseg></trk>\n"}else if(2==b){"track"==a&&(q+="   <trk>\n");var L=1,M=1;for(var s in routes){var e=routes[s],N=s.replace(/route/,"");for(N=parseInt(N),"track"==a?q+="   <trkseg>\n":"route"==a&&(q+="   <rte>\n"),("track"==a||"route"==a)&&(q+="      <name>"+s+"</name>\n",q+="      <cmt>"+milestones[N]+" to "+milestones[N+1]+"</cmt>\n",q+="      <desc>"+milestones[N]+" to "+milestones[N+1]+"</desc>\n"),m=0;m<e.length;m++)if(m==e.length-1||void 0!=e[m].desc){switch(a){case"track":q+="      <trkpt ";break;case"route":q+="      <rtept ";break;case"points":q+="      <wpt "}switch(q+='lat="'+e[m].lat+'" '+'lon="'+e[m].lon+'">\n'+"         <name>",m==e.length-1?(e[m].desc=milestones[N+1],q+="GMLS-"+(100>M?"0":"")+(10>M?"0":"")+M,M+=1,L-=1):q+="GRTP-"+(100>L?"0":"")+(10>L?"0":"")+L,q+="</name>\n         <cmt>"+e[m].desc+"</cmt>\n"+"         <desc>"+e[m].desc+"</desc>\n",a){case"track":q+="      </trkpt>\n";break;case"route":q+="      </rtept>\n";break;case"points":q+="      </wpt>\n"}L++}"track"==a?q+="   </trkseg>\n":"route"==a&&(q+="   </rte>\n")}"track"==a&&(q+="   </trk>\n")}else if(1==b)for(m=0;m<routes.poi.length;m++){var O=routes.poi[m];q+='   <wpt lat="'+O.lat+'" lon="'+O.lon+'">\n'+"      <name>"+O.desc+"</name>\n"+"      <cmt>"+O.desc.replace(/(.*) \((.*)\)/,"$2 ($1)")+"</cmt>\n"+"      <desc>"+O.desc.replace(/(.*) \((.*)\)/,"$2 ($1)")+"</desc>\n"+"   </wpt>\n"}else errorbox('An unknown error occurred. Please leave a bug report at the <a href="http://www.elsewhere.org/GMapToGPX/">project homepage</a> and include a link to the page you\'re on right now.'),error=1;q+="</gpx>\n",q+="</textarea>",q+="<div style='background-color:gray;'>",q+='<ul class="menubar">',q+='<li class="menubar"><a href="javascript:loadabout()">About</a></li>',q+='<li class="menubar"><a href="javascript:closebox()">CLOSE [X]</a></li></ul></div></div>',displaybox(q)}function displaybox(a){closebox(),(googlepage=document.getElementById("page"))&&(googlepage.style.display="none");var b=document.body.appendChild(document.createElement("div"));b.id="gpxbox",b.style.position="absolute",null!=self.pageYOffset?b.style.top=self.pageYOffset+"px":null!=document.documentElement.scrollTop&&(b.style.top=document.documentElement.scrollTop+"px"),b.style.width="99%",b.style.zIndex="1000",b.innerHTML=a}function closebox(){var a;(a=document.getElementById("gpxbox"))&&document.body.removeChild(a),void 0!=googlepage&&(googlepage.style.display="block")}function loadabout(){var a='<span style="font-size: x-small;"><p><a href="http://www.elsewhere.org/GMapToGPX/">GMapToGPX</a> Extractor '+version+"<br />";a+='A project of <a href="http://www.elsewhere.org/">Communications From Elsewhere</a></p>',a+="<p>Usage:<ul>",a+='<li>"Track" displays driving directions as a GPX track with one or more track segments, depending on the number of milestones in the directions.</li>',a+='<li>"Route" displays driving directions as one or more GPX routes.</li>',a+='<li>"Full" displays driving directions as a GPX track containing one or more track segments, each of which contains every single point on the line Google Maps draws to represent the segment. Use with caution, as long routes may produce huge results.</li>',a+='<li>"Points" displays driving directions as a list of waypoints for each turn in the route. The waypoints will be in order, but this option is mainly intended for devices which can only handle waypoints, not tracks or routes. In most cases, you should use another option.</li>',a+="<li>For single or multiple address searches, there are no display options. You get a list of individual waypoints.</li>",a+='</ul>If you have questions or comments, please visit the <a href="http://www.elsewhere.org/GMapToGPX/">project homepage</a>.</p></span>',showstatusdiv(a)}function errorbox(a){var b='<a href="http://www.elsewhere.org/GMapToGPX/">GMapToGPX</a> v'+version+" (ERROR)<br />"+a;showstatusdiv(b)}function round(a){return parseInt(1e5*a)/1e5}function reload(a){closebox(),0==a?gmaptogpxdiv("route"):"1"==a?gmaptogpxdiv("track"):"2"==a?gmaptogpxdiv("points"):"3"==a&&gmaptogpxdiv("allpoints")}function deamp(a){return a=a.replace(/<br *\/>(.+)/g,", $1"),a=a.replace(/<br *\/>/g,""),a=a.replace(/&#39;/g,"'"),a=a.replace(/\\047/g,"'"),a=a.replace(/\\042/g,'"'),a=a.replace(/&#160;/g," "),a=a.replace(/<\/*b>/g,""),a=a.replace(/<wbr\/*>/g,""),a=a.replace(/<div[^>]*?>.*?<\/div>/g," "),a=a.replace(/\\\'/g,"'"),a=a.replace(/\\\"/g,'"'),a=a.replace(/\\x26/g,"&"),a=a.replace(/&/g,"&amp;"),a=a.replace(/&amp;amp;amp;/g,"&amp;amp;"),a=a.replace(/\\n/g,""),a=a.replace(/\\t/g,""),a=a.replace(/\s+/g," "),a=a.replace(/^\s+/,""),a=a.replace(/\s+$/,""),a=a.replace(/<[^>]+>/,"")}var error=0,version="6.4j",googledoc="",googleurl="",gpxvar="",routes=new Array,polylines=new Array,milestones=new Array,yelp=new Array,googlepage,charset;if(StringBuffer.prototype.append=function(a){return this.buffer.push(a),this},StringBuffer.prototype.toString=function(){return this.buffer.join("")},document.location.hostname.indexOf("google")>=0){var kmlurl;if((kmlurl=document.getElementById("link").href)&&kmlurl.indexOf("msid=")>0&&(kmlurl+="&output=kml",errorbox('This is a "My Maps" page, which means that the original KML used to create it is available. Please <a href="'+kmlurl+'">download the KML file</a> (using this link, not the one provided by Google) and convert it using <a href="http://www.gpsvisualizer.com/convert" target="_new">GPSVisualizer</a>.'),error=1),!error&&(googleurl=document.getElementById("link").href)){googleurl=googleurl.replace(/&view=text/,""),googledoc=loadXMLDoc(googleurl),charset=googledoc.slice(googledoc.indexOf("charset=")),charset=charset.slice(8,charset.indexOf('"'));var encpointblob=googledoc.slice(googledoc.indexOf("gHomeVPage="));encpointblob=encpointblob.slice(0,encpointblob.indexOf("};")+2),encpointblob=encpointblob.replace(/gHomeVPage/,"gpxvar"),eval(encpointblob);var panel=googledoc.slice(googledoc.indexOf('id="panel_dir"'));panel=panel.slice(0,panel.indexOf("Map data")),gpxvar.panel=panel,googledoc=fixup(googledoc)}}if(charset=charset?charset:"UTF-8",!navigator.userAgent.match(/Safari/)){var styleObject=document.getElementsByTagName("HEAD")[0].appendChild(document.createElement("link"));styleObject.rel="Stylesheet",styleObject.type="text/css",styleObject.href="http://www.elsewhere.org/GMapToGPX/menubar.css",styleObject.id="sst_css"}1!=error?gmaptogpxdiv("route"):closebox();